# BDP Environment Configuration
# Copy this file to .env and update values for your environment

# ============================================================================
# PostgreSQL Database Configuration
# ============================================================================
POSTGRES_DB=bdp
POSTGRES_USER=bdp
POSTGRES_PASSWORD=bdp_dev_password
POSTGRES_PORT=5432

# Database connection settings
# Connection string used by the application at runtime and during development builds
# Format: postgresql://user:password@host:port/database
DATABASE_URL=postgresql://bdp:bdp_dev_password@localhost:5432/bdp

# Connection pool configuration
DB_MAX_CONNECTIONS=20
DB_MIN_CONNECTIONS=5
DB_CONNECT_TIMEOUT=30
DB_IDLE_TIMEOUT=600
DB_MAX_LIFETIME=1800

# ============================================================================
# SQLx Configuration
# ============================================================================
# SQLx supports two compilation modes:
#
# Online Mode (SQLX_OFFLINE=false or unset):
#   - SQLx connects to DATABASE_URL during compilation
#   - Validates SQL queries against the actual database schema
#   - Requires running database during `cargo build`
#   - Best for local development
#
# Offline Mode (SQLX_OFFLINE=true):
#   - SQLx uses pre-generated .sqlx/*.json metadata files
#   - No database connection needed during compilation
#   - Required for CI/CD pipelines and Docker builds
#   - Faster compilation (no database connection overhead)
#
# Default: false (online mode for development)
# Set to true in CI/CD environments and when building without database access
SQLX_OFFLINE=false

# Generate .sqlx metadata files with:
#   ./scripts/dev/sqlx-prepare.sh
#
# For more information, see docs/development/sqlx-setup.md

# ============================================================================
# Test Database Configuration
# ============================================================================
# Separate database instance for running tests
# This prevents test data from contaminating the development database
# and allows for safe cleanup between test runs.
#
# The test database runs on a different port (5433) to avoid conflicts
# with the development database (5432).
#
# Test database docker-compose service configuration:
TEST_POSTGRES_DB=bdp_test
TEST_POSTGRES_USER=bdp
TEST_POSTGRES_PASSWORD=bdp_test_password
TEST_POSTGRES_PORT=5433

# Test database connection string
# Used by test suites and test scripts
# Note: Port 5433 (different from development database on 5432)
TEST_DATABASE_URL=postgresql://bdp:bdp_test_password@localhost:5433/bdp_test

# Start/manage test database with:
#   ./scripts/dev/test-db-setup.sh start
#   ./scripts/dev/test-db-setup.sh migrate
#   ./scripts/dev/test-db-setup.sh reset

# ============================================================================
# MinIO / S3 Storage Configuration
# ============================================================================
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin
MINIO_PORT=9000
MINIO_CONSOLE_PORT=9001
MINIO_BUCKET=bdp-data
MINIO_REGION=us-east-1
MINIO_DOMAIN=minio

# Storage Configuration (for backend)
STORAGE_TYPE=s3
STORAGE_S3_ENDPOINT=http://localhost:9000
STORAGE_S3_REGION=us-east-1
STORAGE_S3_BUCKET=bdp-data
STORAGE_S3_ACCESS_KEY=minioadmin
STORAGE_S3_SECRET_KEY=minioadmin
STORAGE_S3_PATH_STYLE=true

# For production AWS S3, use:
# STORAGE_TYPE=s3
# STORAGE_S3_ENDPOINT=https://s3.amazonaws.com
# STORAGE_S3_PATH_STYLE=false
# STORAGE_S3_ACCESS_KEY=your_aws_access_key
# STORAGE_S3_SECRET_KEY=your_aws_secret_key

# ============================================================================
# Backend Server Configuration
# ============================================================================
SERVER_HOST=0.0.0.0
SERVER_PORT=8000
RUST_LOG=info,bdp_server=debug,sqlx=warn

# API Configuration
API_BASE_URL=http://localhost:8000

# CORS Configuration
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8000
CORS_ALLOW_CREDENTIALS=true

# ============================================================================
# Security Configuration
# ============================================================================
# IMPORTANT: Change these in production!
JWT_SECRET=dev_jwt_secret_change_in_production_to_random_64_char_string

# For production, generate a secure secret:
# openssl rand -base64 64

# ============================================================================
# Rate Limiting
# ============================================================================
# Number of requests allowed per minute per IP address
RATE_LIMIT_REQUESTS_PER_MINUTE=100

# ============================================================================
# Frontend Configuration (Next.js)
# ============================================================================
NEXT_PUBLIC_API_URL=http://localhost:8000
NEXT_PUBLIC_APP_NAME=BDP
NEXT_PUBLIC_APP_VERSION=0.1.0

# ============================================================================
# Docker Build Configuration
# ============================================================================
BUILD_TARGET=development
# Options: development, production

# ============================================================================
# Logging Configuration
# ============================================================================
# Minimum log level: trace, debug, info, warn, error
LOG_LEVEL=info

# Output target: console, file, both
LOG_OUTPUT=console

# Log format: text, json
# Use 'text' for development (human-readable)
# Use 'json' for production (structured, machine-parseable)
LOG_FORMAT=text

# Directory for log files (only used when LOG_OUTPUT is 'file' or 'both')
LOG_DIR=./logs

# Log file name prefix
# For server: bdp-server.2024-01-18.log
# For CLI: bdp-cli.2024-01-18.log
# For ingest: bdp-ingest.2024-01-18.log
LOG_FILE_PREFIX=bdp

# Module-specific log level filters (comma-separated)
# Example: sqlx=warn,tower_http=info,bdp_server::features=debug
# This allows fine-tuning specific module log levels
LOG_FILTER=sqlx=warn,tower_http=info

# Include file and line numbers in logs (useful for debugging)
LOG_INCLUDE_LOCATION=false

# Include thread IDs in logs (useful for debugging async issues)
LOG_INCLUDE_THREAD_IDS=false

# Include module/target names in logs
LOG_INCLUDE_TARGETS=true

# Production Logging Recommendation:
# LOG_LEVEL=info
# LOG_OUTPUT=both
# LOG_FORMAT=json
# LOG_DIR=/var/log/bdp
# LOG_FILTER=sqlx=warn,tower_http=info

# Development Logging Recommendation:
# LOG_LEVEL=debug
# LOG_OUTPUT=console
# LOG_FORMAT=text
# LOG_INCLUDE_LOCATION=true

# ============================================================================
# Legacy RUST_LOG (kept for compatibility)
# ============================================================================
# Note: The new LOG_* variables above take precedence
# RUST_LOG is still supported but LOG_LEVEL and LOG_FILTER are preferred
RUST_LOG=info,bdp_server=debug,sqlx=warn

# ============================================================================
# Data Ingestion Configuration
# ============================================================================
# Enable/disable the ingestion system
INGEST_ENABLED=false

# Number of worker threads for processing jobs
INGEST_WORKER_THREADS=4

# Maximum retry attempts for failed jobs
INGEST_MAX_RETRIES=3

# Job timeout in seconds (default: 1 hour)
INGEST_JOB_TIMEOUT_SECS=3600

# ============================================================================
# UniProt Ingestion Configuration
# ============================================================================
# FTP server configuration
INGEST_UNIPROT_FTP_HOST=ftp.uniprot.org
INGEST_UNIPROT_FTP_PATH=/pub/databases/uniprot/current_release/knowledgebase/complete
INGEST_UNIPROT_FTP_TIMEOUT_SECS=300

# Version configuration (format: YYYY_MM)
INGEST_UNIPROT_OLDEST_VERSION=2020_01

# Automatic ingestion schedule (cron format)
INGEST_UNIPROT_SCHEDULE="0 2 * * *"  # Daily at 2 AM
INGEST_UNIPROT_AUTO_ENABLED=false

# Batch size for processing entries
INGEST_UNIPROT_BATCH_SIZE=1000

# ============================================================================
# Cache Configuration (CLI)
# ============================================================================
BDP_CACHE_DIR=~/.bdp/cache
BDP_CACHE_MAX_SIZE=50GB

# ============================================================================
# Development Tools
# ============================================================================
# Set to "true" to enable development features
DEV_MODE=true
DEV_AUTO_MIGRATE=true
DEV_SEED_DATA=true

# ============================================================================
# Production Configuration
# ============================================================================
# Uncomment and configure for production deployment

# Domain and SSL
# DOMAIN=bdp.example.com
# SSL_EMAIL=admin@example.com

# Production Database (managed service)
# DATABASE_URL=postgresql://user:pass@prod-db.example.com:5432/bdp
# DATABASE_MAX_CONNECTIONS=50

# Production S3
# S3_ENDPOINT=https://s3.amazonaws.com
# S3_BUCKET=prod-bdp-data
# S3_ACCESS_KEY=prod_access_key
# S3_SECRET_KEY=prod_secret_key

# Production Security
# JWT_SECRET=production_secret_generated_with_openssl_rand_base64_64

# Monitoring
# ENABLE_METRICS=true
# METRICS_PORT=9090
# ENABLE_TRACING=true
# JAEGER_ENDPOINT=http://jaeger:14268/api/traces

# Backup Configuration
# BACKUP_ENABLED=true
# BACKUP_SCHEDULE="0 3 * * *"  # Daily at 3 AM
# BACKUP_RETENTION_DAYS=30
# BACKUP_S3_BUCKET=bdp-backups
